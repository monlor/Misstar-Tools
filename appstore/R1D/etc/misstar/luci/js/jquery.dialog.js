(function($){var _isIE6=!!($.browser.msie&&$.browser.version=="6.0"),_isFixed=!_isIE6,tmpl=function(sTmpl,opts){return sTmpl.replace(/\{\$(\w+)\}/g,function(a,b){return opts[b]})},_mix=function(des,src,override){for(var i in src){if(override||!(i in des)){des[i]=src[i]}}return des},version="1.0.0",defaults={content:'<div class="d-loading"><span>'+i18n.dialog.loading+"</span></div>",title:i18n.dialog.dlgtitle,button:null,ok:null,cancel:null,initialize:null,beforeunload:null,okValue:i18n.dialog.ok,cancelValue:i18n.dialog.cancel,width:"600",height:"auto",padding:"25px 30px",time:null,visible:true,lock:false,fixed:false,zIndex:1000},tplMask='<div class="panel-mask" style="position:fixed;left:0;top:0;style:none;"><iframe style="width:100%;height:100%;filter:alpha(opacity=0);"></iframe></div>',tplDialog='<div class="panel panel-dialog" style="position:fixed;left:0;top:0;style:none;"><div class="panel-content"><div class="hd"><h3 class="d-hd"></h3></div><div class="bd"><div class="d-bd"></div></div><div class="ft"><div class="d-ft"></div></div></div><span class="close d-close"></span></div>';function Dialog(opt){var _opt=_mix(opt,defaults);if(!_isFixed){_opt.fixed=false}if(!_opt.button||!$.isArray(_opt.button)){_opt.button=[]}if(_opt.ok){_opt.button.push({id:"ok",value:_opt.okValue,callback:_opt.ok,focus:true})}if(_opt.cancel){_opt.button.push({id:"cancel",value:_opt.cancelValue,callback:_opt.cancel,focus:false})}defaults.zIndex=_opt.zIndex;this.options=_opt;this.initialize()}Dialog.prototype={_dom:null,_islock:false,_lockMask:null,initialize:function(){this._creat();this.show();this._addEvent()},title:function(str){var dom=this._dom,title=dom.hd,classname="d-is-notitle";if(str===false){title.hide();dom.self.addClass(classname)}else{title.html(str).show();dom.self.removeClass(classname)}return this},content:function(str){var str=str||"";this._dom.bd.html(str);return this},lock:function(){if(this._isLock){return this}var that=this,options=this.options,dom=this._dom,$mask=$(tplMask),index=defaults.zIndex-1;this.zIndex();$mask.css({zIndex:index,position:"fixed",left:0,top:0,width:"100%",height:"100%",overflow:"hidden"});if(!_isFixed){$mask.css({position:"absolute",width:$(window).width()+"px",height:$(document).height()+"px"})}$mask.appendTo(document.body);$mask.show();this._lockMask=$mask;this._isLock=true;return this},unlock:function(){if(this._isLock){this._lockMask.remove();this._lockMask=null;this._isLock=false}else{return this}},show:function(){var dom=this._dom;this.zIndex();this.position();dom.self.show();dom.self.focus();dom.self.addClass("d-is-open");return this},close:function(){var onbeforeunload=this.options.beforeunload,dom=this._dom;if(onbeforeunload&&onbeforeunload.call(this)===false){return this}if(Dialog.focus===this){Dialog.focus=null}dom.self.remove();this._removeEvent();this.unlock();delete Dialog.list[this.options.id];return this},time:function(time){var that=this,timer=this._timer;timer&&clearTimeout(timer);if(time){this._timer=setTimeout(function(){that.close()},time)}return this},size:function(w,h){var dom=this._dom;dom.self.width(w).height(h);this.position();return this},position:function(){var dom=this._dom,wrap=dom.self,el=wrap[0],$window=$(window),$document=$(document),fixed=this.options.fixed,dl=fixed?0:$document.scrollLeft(),dt=fixed?0:$document.scrollTop(),ww=$window.width(),wh=$window.height(),ow=el.offsetWidth,oh=el.offsetHeight,left=(ww-ow)/2+dl,top=(wh-oh)*382/1000+dt,style=el.style,zindex=defaults.zIndex;if(_isFixed){style.position=fixed?"fixed":"absolute"}else{style.position="absolute"}style.left=Math.max(parseInt(left),dl)+"px";style.top=Math.max(parseInt(top),dt)+"px";style.zIndex=zindex;return this},button:function(){var dom=this._dom,that=this,ft=dom.ft,primary="btn-primary",dft="btn-dft",btns=[].slice.call(arguments),buttons=this._buttons=this._buttons||{},value,id,button,isNewBtn,btn;for(var i=0;i<btns.length;i++){btn=btns[i];value=btn.value;id=btn.id;isNewBtn=!this._buttons[id];if(isNewBtn){if(!buttons[id]){buttons[id]={}}button=$('<a href="#" data-id="'+id+'" class="btn '+dft+'"><span>'+value+"</span></a>");buttons[id].elem=button;if(btn.callback){buttons[id].callback=btn.callback}if(btn.disabled){button.prop("disabled",true);button.removeClass(dft).addClass("btn-disabeld")}if(btn.focus){button.removeClass(dft).addClass(primary)}ft.append(button)}}ft[0].style.display=btns.length?"":"none";return this},zIndex:function(){var dom=this._dom,index=defaults.zIndex++;dom.self.css("zIndex",index);this._lockMask&&this._lockMask.css("zIndex",index-1);Dialog.focus=this;return this},_creat:function(){var dom=this._buildHTML(),initialize=this.options.initialize,title=this.options.title,content=this.options.content,width=this.options.width,height=this.options.height,time=this.options.time,lock=this.options.lock,padding=this.options.padding,cancel=this.options.cancel;this._dom=dom;dom.bd.css("padding",padding);this.title(title).content(content).size(width,height);if(time){this.time(time)}if(lock){this.lock()}if(cancel===false){dom.close.hide()}this.button.apply(this,this.options.button);if(initialize&&typeof(initialize)==="function"){initialize.call(this)}},_addEvent:function(){var that=this,dom=this._dom;$(window).on("resize",function(){that.position()});dom.close.on("click",function(e){setTimeout(function(){that.close()},0)});dom.ft.find(".btn").on("click",function(e){e.preventDefault();var id=$(this).attr("data-id");id&&that._btnCallback(id)});dom.self.on("mousedown",function(){that.zIndex()});$(document).on("keydown",function(event){var target=event.target,nodeName=target.nodeName,rinput=/^input|textarea$/i,dom=that._dom,top=Dialog.focus,keyCode=event.keyCode;if(!top||rinput.test(nodeName)&&target.type!=="button"){return}if(top.options.cancel!==false){keyCode===27&&top.close()}})},_removeEvent:function(){$(window).unbind("resize");$(document).unbind("keydown");this._dom.close.unbind()},_buildHTML:function(){var body=document.body,dom={},elem;if(!body){throw new Error('artDialog: "documents.body" not ready')}elem=$(tplDialog);body.insertBefore(elem[0],body.firstChild);dom.hd=elem.find(".d-hd");dom.bd=elem.find(".d-bd");dom.ft=elem.find(".d-ft");dom.close=elem.find(".d-close");dom.self=elem;return dom},_btnCallback:function(id){var fn=this._buttons[id]&&this._buttons[id].callback;return typeof fn!=="function"||fn.call(this)!==false?this.close():this}};Dialog.version=version;Dialog.list={};Dialog.focus=null;Dialog.get=function(id){return id==undefined?Dialog.list:Dialog.list[id]};window.art={};window.art.dialog=$.dialog=function(opt){var _dialog;_id=opt.id;if(!_id){_id=opt.id="id"+new Date().getTime()}if(_id&&Dialog.list[_id]){_dialog=Dialog.list[_id];_dialog.zIndex()}else{_dialog=Dialog.list[_id]=new Dialog(opt)}return _dialog};window.art.dialog.get=$.dialog.get=Dialog.get;window.art.dialog.version=$.dialog.version=Dialog.version})(jQuery);